<div class="card !bg-white !shadow-xl !rounded-xl !p-6">
  <div class="p-inputgroup !flex !flex-col md:!flex-row md:!items-center md:!justify-between !gap-4 !mb-8">
    <input
      type="text"
      pInputText
      placeholder="Filtrar por anotación o descripción"
      [(ngModel)]="filterValue"
      (input)="onFilterChange()"
      class="p-inputtext !border-2 !border-blue-700 !text-gray-800 !bg-white !placeholder-gray-400 hover:!bg-blue-50 !transition !font-medium !rounded-lg !px-4 !py-2 focus:!outline-none focus:!ring-2 focus:!ring-blue-400 !w-full md:!w-80 !shadow-sm"
    />
    <button
      pButton
      type="button"
      label="Actualizar nuevas facturas"
      (click)="refreshInvoices()"
      icon="pi pi-refresh"
      class="p-button-outlined !border-2 !border-blue-700 !text-blue-700 !bg-white hover:!bg-blue-100 !transition !font-semibold !rounded-lg !px-8 !py-2 focus:!outline-none focus:!ring-2 focus:!ring-blue-400 !shadow-sm"
    ></button>
  </div>
  <div *ngIf="loading" class="p-mb-2 !text-blue-700 !font-semibold">
    <p>Descargando facturas...</p>
  </div>
  <div *ngIf="progress > 0" class="p-mb-2 !text-blue-700 !font-semibold">
    <p>Progreso: {{ progress }} facturas descargadas.</p>
  </div>
  <div *ngIf="!loading && invoices.length === 0 && !updating" class="p-mb-2 !text-red-600 !font-semibold">
    <p>No se encontraron resultados para el filtro ingresado.</p>
  </div>
  <div class="table-container !overflow-x-auto !rounded-xl !border !border-gray-200 !bg-gray-50 !shadow-lg">
    <p-table
      [value]="invoices"
      [paginator]="true"
      [rows]="rows"
      [totalRecords]="totalRecords"
      [lazy]="true"
      [loading]="loading"
      [responsiveLayout]="'scroll'"
      (onLazyLoad)="loadInvoicesLazy($event)"
      class="!w-full"
    >
      <ng-template pTemplate="header">
        <tr class="!bg-blue-800 !text-white !text-sm">
          <th class="!px-6 !py-4 !font-bold !text-left !rounded-tl-xl">ID</th>
          <th class="!px-6 !py-4 !font-bold !text-left">Cliente</th>
          <th class="!px-6 !py-4 !font-bold !text-left">Fecha</th>
          <th class="!px-6 !py-4 !font-bold !text-left">Anotación</th>
          <th class="!px-6 !py-4 !font-bold !text-left">Descripción Items</th>
          <th class="!px-6 !py-4 !font-bold !text-left !rounded-tr-xl">Acción</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-invoice>
        <tr class="!bg-white !border-b !border-gray-100 hover:!bg-blue-50 !transition !shadow-sm">
          <td class="!px-6 !py-4 !font-mono !font-bold !text-blue-900">{{ invoice.numberTemplate.number }}</td>
          <td class="!px-6 !py-4 !text-gray-900">{{ invoice.client?.name }}</td>
          <td class="!px-6 !py-4 !text-gray-700">{{ invoice.date }}</td>
          <td class="!px-6 !py-4 !text-gray-700">{{ invoice.anotation }}</td>
          <td class="!px-6 !py-4 !text-gray-700">
            <span *ngFor="let item of invoice.items; let i = index">
              {{ item.description }}<span *ngIf="i < invoice.items.length - 1">, </span>
            </span>
          </td>
          <td class="!px-6 !py-4">
            <button
              pButton
              type="button"
              label="Ver"
              (click)="goToAlegra(invoice.id)"
              icon="pi pi-refresh"
              class="p-button-outlined !border-2 !border-blue-600 !text-blue-700 !bg-white hover:!bg-blue-100 !transition !font-semibold !rounded-xl !px-5 !py-2 focus:!outline-none focus:!ring-2 focus:!ring-blue-400"
            >
              <i class="fa fa-external-link-alt"></i>
            </button>
          </td>
        </tr>
      </ng-template>
      
    </p-table>
  </div>
</div>